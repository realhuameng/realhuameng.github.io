<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Hua Meng,1263313190@qq.com"><title>手搓Spring-06实现应用上下文、自动识别、资源加载、扩展机制 · Realhuameng</title><meta name="description" content="实现应用上下文目标DefaultListableBeanFactory、XmlBeanDefinitionReader，是我们在目前 Spring 框架中对于服务功能测试的使用方式，它能很好的体现出 Spring 是如何对 xml 加载以及注册Bean对象的操作过程，但这种方式是面向 Spring "><meta name="keywords" content="C++,Linux,Java,Go"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Realhuameng</a></h3><div class="description"><p>Fake it till you make it.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="http://github.com/realhuameng"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai </a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首頁</a></li><li><a href="/about">關於</a></li><li><a href="/archives">歸檔</a></li><li><a href="/links">連結</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/favicon.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>手搓Spring-06实现应用上下文、自动识别、资源加载、扩展机制</a></h3></div><div class="post-content"><h1 id="实现应用上下文"><a href="#实现应用上下文" class="headerlink" title="实现应用上下文"></a>实现应用上下文</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>DefaultListableBeanFactory、XmlBeanDefinitionReader，是我们在目前 Spring 框架中对于服务功能测试的使用方式，它能很好的体现出 Spring 是如何对 xml 加载以及注册Bean对象的操作过程，但这种方式是面向 Spring 本身的，还不具备一定的扩展性。 </p>
<p>这部分我们要把 Bean 对象扩展机制功能和对 Spring 框架上下文的包装融合起来，对外提供完整的服务。</p>
<h2 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h2><p>为了满足于在Bean对象从注册到实例化的过程中执行用户的自定义操作，需要在Bean的定义和初始化过程中插入接口类，这个接口再有外部去实现自己需要的服务</p>
<p>满足对Bean对象扩展的两个接口，也是Spring框架中比较重要的两个接口：BeanFactoryPostProcessor、BeanPostProcessor</p>
<p>BeanFactoryPostProcessor是Spring框架提供的容器扩展机制，允许Bean对象注册后但未实例化之前，对BeanDefinition执行修改操作</p>
<p>BeanPostProcessor是在Bean对象实例化之后修改Bean对象，也可以替换Bean对象</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>Spring应用上下文和Bean对象扩展机制的类关系</p>
<p>以继承了 ListableBeanFactory 接口的 ApplicationContext 接口开始，扩展出一系列应用上下文的抽象实现类，并最终完成 ClassPathXmlApplicationContext 类的实现。而这个类就是最后交给用户使用的类。 </p>
<p>同时在实现应用上下文的过程中，通过定义接口：BeanFactoryPostProcessor、BeanPostProcessor 两个接口，把关于对 Bean 的扩展机制串联进去了。</p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20135349.png"></p>
<h3 id="定义BeanFactoryPostProcessor"><a href="#定义BeanFactoryPostProcessor" class="headerlink" title="定义BeanFactoryPostProcessor"></a>定义BeanFactoryPostProcessor</h3><p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20170523.png"></p>
<h3 id="定义BeanPostProcessor"><a href="#定义BeanPostProcessor" class="headerlink" title="定义BeanPostProcessor"></a>定义BeanPostProcessor</h3><p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20170916.png"></p>
<h3 id="定义上下文接口"><a href="#定义上下文接口" class="headerlink" title="定义上下文接口"></a>定义上下文接口</h3><p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20171550.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20171811.png"></p>
<h3 id="应用上下文抽象类实现"><a href="#应用上下文抽象类实现" class="headerlink" title="应用上下文抽象类实现"></a>应用上下文抽象类实现</h3><p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20181913.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20181932.png"></p>
<h3 id="获取Bean工厂和加载资源"><a href="#获取Bean工厂和加载资源" class="headerlink" title="获取Bean工厂和加载资源"></a>获取Bean工厂和加载资源</h3><p>在 refreshBeanFactory() 中主要是获取了 <code>DefaultListableBeanFactory</code> 的实例化以及对资源配置的加载操作 <code>loadBeanDefinitions(beanFactory)</code>，在加载完成后即可完成对 spring.xml 配置文件中 Bean 对象的定义和注册，同时也包括实现了接口 BeanFactoryPostProcessor、BeanPostProcessor 的配置 Bean 信息。</p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20201833.png"></p>
<h3 id="上下文中对配置信息的加载"><a href="#上下文中对配置信息的加载" class="headerlink" title="上下文中对配置信息的加载"></a>上下文中对配置信息的加载</h3><p>在AbstractXmlApplicationContext抽象类的loadBeanDefinitions方法实现中，使用XmlBeanDefinitionReader类，处理了关于XML文件配置信息的操作</p>
<p>getConfigLocations()方法是为了从入口上下文类拿到配置信息的地址描述</p>
<p><img src="C:\Users\huameng\AppData\Roaming\Typora\typora-user-images\image-20240128202715385.png" alt="image-20240128202715385"></p>
<h3 id="应用上下文实现类-ClassPathXmlApplicationContext"><a href="#应用上下文实现类-ClassPathXmlApplicationContext" class="headerlink" title="应用上下文实现类(ClassPathXmlApplicationContext)"></a>应用上下文实现类(ClassPathXmlApplicationContext)</h3><p>ClassPathXmlApplicationContext是具体对外给用户提供的应用上下文的方法</p>
<p><img src="C:\Users\huameng\AppData\Roaming\Typora\typora-user-images\image-20240128203324997.png" alt="image-20240128203324997"></p>
<h3 id="在Bean创建时完成前置和后置处理"><a href="#在Bean创建时完成前置和后置处理" class="headerlink" title="在Bean创建时完成前置和后置处理"></a>在Bean创建时完成前置和后置处理</h3><p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-29%20154215.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-29%20154316.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-29%20154334.png"></p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p><img src="C:\Users\huameng\AppData\Roaming\Typora\typora-user-images\image-20240128171409276.png" alt="image-20240128171409276"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20172855.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20173223.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20173332.png"></p>
<p><img src="https://my-blog-realhuameng.oss-cn-hangzhou.aliyuncs.com/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-01-28%20173408.png"></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2024-01-28</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://realhuameng.github.io/2024/01/28/shou-cuo-spring-06-shi-xian-ying-yong-shang-xia-wen-zi-dong-shi-bie-zi-yuan-jia-zai-kuo-zhan-ji-zhi/,Realhuameng,手搓Spring-06实现应用上下文、自动识别、资源加载、扩展机制,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2024/01/29/shou-cuo-spring-07-xiang-xu-ni-ji-zhu-ce-gou-zi-shi-xian-bean-dui-xiang-de-chu-shi-hua-he-xiao-hui-fang-fa/" title="手搓Spring-07向虚拟机注册钩子，实现Bean对象的初始化和销毁方法">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2024/01/27/shou-cuo-spring-05-zi-yuan-jia-zai-qi-jie-xi-wen-jian-zhu-ce-dui-xiang/" title="手搓Spring-05资源加载器解析文件注册对象">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>